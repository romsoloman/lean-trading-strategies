[{"text": "\"\"\"\nStop loss management for Rom150Bot.\n\nHandles both static stop losses and trailing stops.\n\"\"\"\n\n\nclass StopLossManager:\n    \"\"\"Manages static stop loss prices.\"\"\"\n    \n    def __init__(self, stop_percentage):\n        \"\"\"Initialize the stop loss manager.\"\"\"\n        self.stop_percentage = stop_percentage\n        self.stop_prices = {}\n    \n    def calculate_stop_price(self, sma150_value):\n        \"\"\"Calculate stop loss price based on SMA150.\"\"\"\n        if sma150_value <= 0:\n            return 0\n        return sma150_value * (1.0 - self.stop_percentage)\n    \n    def update_stop_price(self, symbol, sma150_value):\n        \"\"\"Update the stop price for a symbol.\"\"\"\n        self.stop_prices[symbol] = self.calculate_stop_price(sma150_value)\n    \n    def get_stop_price(self, symbol):\n        \"\"\"Get the current stop price for a symbol.\"\"\"\n        return self.stop_prices.get(symbol, None)\n    \n    def remove_stop(self, symbol):\n        \"\"\"Remove stop tracking for a symbol.\"\"\"\n        if symbol in self.stop_prices:\n            del self.stop_prices[symbol]\n\n\nclass TrailingStopManager:\n    \"\"\"Manages trailing stops that activate after profit threshold.\"\"\"\n    \n    def __init__(self, profit_threshold, atr_multiplier):\n        \"\"\"Initialize the trailing stop manager.\"\"\"\n        self.profit_threshold = profit_threshold\n        self.atr_multiplier = atr_multiplier\n        self.trailing_active = {}\n        self.highest_price = {}\n        self.trailing_stop_price = {}\n    \n    def update(self, symbol, current_price, entry_price, atr_value):\n        \"\"\"Update trailing stop for a position.\"\"\"\n        profit_pct = (current_price - entry_price) / entry_price\n        \n        # Activate trailing stop if profit threshold reached\n        if not self.trailing_active.get(symbol, False):\n            if profit_pct >= self.profit_threshold:\n                self.trailing_active[symbol] = True\n                self.highest_price[symbol] = current_price\n        \n        # If trailing is active, update highest price and stop\n        if self.trailing_active.get(symbol, False):\n            if current_price > self.highest_price.get(symbol, 0):\n                self.highest_price[symbol] = current_price\n            \n            trailing_stop = self.highest_price[symbol] - (self.atr_multiplier * atr_value)\n            self.trailing_stop_price[symbol] = trailing_stop\n            return trailing_stop\n        \n        return None\n    \n    def is_active(self, symbol):\n        \"\"\"Check if trailing stop is active for a symbol.\"\"\"\n        return self.trailing_active.get(symbol, False)\n    \n    def get_stop_price(self, symbol):\n        \"\"\"Get the current trailing stop price.\"\"\"\n        return self.trailing_stop_price.get(symbol, None)\n    \n    def remove_trailing_stop(self, symbol):\n        \"\"\"Remove trailing stop tracking for a symbol.\"\"\"\n        if symbol in self.trailing_active:\n            del self.trailing_active[symbol]\n        if symbol in self.highest_price:\n            del self.highest_price[symbol]\n        if symbol in self.trailing_stop_price:\n            del self.trailing_stop_price[symbol]\n", "type": "text"}]