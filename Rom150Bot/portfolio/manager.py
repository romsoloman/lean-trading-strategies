[{"text": "\"\"\"\nPortfolio state management for Rom150Bot.\n\nTracks positions, entry counts, and portfolio constraints.\n\"\"\"\n\n\nclass PortfolioManager:\n    \"\"\"\n    Manages portfolio state and constraints.\n    \n    Responsibilities:\n    - Track entry counts per symbol (pyramiding)\n    - Track entry prices\n    - Validate portfolio capacity\n    - Clean up position tracking\n    \"\"\"\n    \n    def __init__(self, max_positions, max_entries_per_symbol):\n        \"\"\"Initialize the portfolio manager.\"\"\"\n        self.max_positions = max_positions\n        self.max_entries_per_symbol = max_entries_per_symbol\n        self.entry_count = {}\n        self.entry_prices = {}\n    \n    def can_open_new_position(self, current_position_count):\n        \"\"\"Check if we can open a new position.\"\"\"\n        return current_position_count < self.max_positions\n    \n    def can_add_to_position(self, symbol):\n        \"\"\"Check if we can add to an existing position (pyramiding).\"\"\"\n        current_entries = self.entry_count.get(symbol, 0)\n        return current_entries < self.max_entries_per_symbol\n    \n    def record_entry(self, symbol, price):\n        \"\"\"Record a new entry for a symbol.\"\"\"\n        self.entry_count[symbol] = self.entry_count.get(symbol, 0) + 1\n        if symbol not in self.entry_prices:\n            self.entry_prices[symbol] = []\n        self.entry_prices[symbol].append(price)\n    \n    def get_entry_count(self, symbol):\n        \"\"\"Get the number of entries for a symbol.\"\"\"\n        return self.entry_count.get(symbol, 0)\n    \n    def get_entry_prices(self, symbol):\n        \"\"\"Get all entry prices for a symbol.\"\"\"\n        return self.entry_prices.get(symbol, [])\n    \n    def clear_position(self, symbol):\n        \"\"\"Clear tracking for a closed position.\"\"\"\n        self.entry_count[symbol] = 0\n        self.entry_prices[symbol] = []\n    \n    def initialize_symbol(self, symbol):\n        \"\"\"Initialize tracking for a new symbol.\"\"\"\n        self.entry_count[symbol] = 0\n        self.entry_prices[symbol] = []\n    \n    def remove_symbol(self, symbol):\n        \"\"\"Remove tracking for a symbol.\"\"\"\n        if symbol in self.entry_count:\n            del self.entry_count[symbol]\n        if symbol in self.entry_prices:\n            del self.entry_prices[symbol]\n", "type": "text"}]